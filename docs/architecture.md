# PTCGP 봇 시스템 아키텍처

## 현재 아키텍처 (병렬 실행)

```
┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐
│   Poke.py   │  │  Poke2.py   │  │  Poke20.py  │  │  Poke3.py   │
│  (Group7,8) │  │ (Main Bot)  │  │ (20% Pack)  │  │ (Group1,3,6)│
└──────┬──────┘  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘
       │                │                │                │
       └────────────────┴────────────────┴────────────────┘
                               │
                        Discord Server
```

각 봇이 독립적으로 실행되며, 명령어 충돌 시 "명령어 없음" 응답으로 무시

## 데이터 저장 구조

### 1. GitHub Gist (Poke.py)
```
- online_users.txt: 온라인 사용자 목록
- god_packs.json: 갓팩 정보
```

### 2. 로컬 파일 시스템 (Poke2.py, Poke20.py)
```
data/
├── heartbeat_data/     # 사용자 활동 기록
│   └── {user_id}.json
├── user_data/          # 사용자 프로필
│   └── {user_id}.json
└── raw/                # 친구 목록
    ├── Old/            # 기존 사용자
    └── New/            # 신규 사용자
```

### 3. 제안된 구조 (Poke20.py 개선)
```
data/
├── raw/                # Poke2.py 전용
└── raw20/              # Poke20.py 전용
    ├── group_1/        # 10명 제한
    ├── group_2/        # 10명 제한
    └── ...
```

## 채널 구조

각 그룹별 동일한 채널 구조:
```
Group N
├── HEARTBEAT_CHANNEL   # 사용자 상태 모니터링
├── DETECT_CHANNEL      # 갓팩/20% 팩 감지
├── POSTING_FORUM       # 포럼 게시
├── COMMAND_CHANNEL     # 봇 명령어
└── MUSEUM_FORUM        # 검증된 갓팩
```

## 명령어 체계

### 텍스트 명령어 (!)
- `!yet`: Yet 태그 포스트 조회
- `!verify`: 갓팩 검증
- `!state`: 온라인 상태 조회
- `!timer`: 타이머 설정

### 슬래시 명령어 (/)
- `/팩선호도`: 선호 팩 설정
- `/목표배럭설정`: 목표 배럭 설정
- `/내정보`: 사용자 정보 조회
- `/친추리스트`: 친구 목록 조회

## 제안된 통합 아키텍처

```
┌─────────────────────────────────────┐
│          Main Bot Core              │
├─────────────────────────────────────┤
│  - Command Router                   │
│  - Event Handler                    │
│  - Data Manager                     │
└──────────────┬──────────────────────┘
               │
       ┌───────┴───────┬───────┬───────┐
       │               │       │       │
┌──────▼────┐ ┌───────▼──┐ ┌──▼───┐ ┌─▼─────┐
│GodPack    │ │20% Pack  │ │Forum │ │Legacy │
│Module     │ │Module    │ │Module│ │Module │
└───────────┘ └──────────┘ └──────┘ └───────┘
```

### 장점
1. 단일 프로세스로 리소스 효율화
2. 공통 기능 재사용
3. 통합 로깅 및 모니터링
4. 일관된 에러 처리

### 구현 전략
1. 기존 봇 기능을 모듈로 분리
2. 공통 인터페이스 정의
3. 점진적 마이그레이션
4. 롤백 계획 수립