# PTCGP 봇 시스템 상세 분석

## 프로젝트 배경
포켓몬 트레이딩 카드 게임에서 특별한 팩들을 관리하는 Discord 봇 시스템
- **갓팩(God Pack)**: 5장 모두 레어 카드 (매우 희귀)
- **20% 팩**: 5장 중 1장만 레어 (상대적으로 흔함)

## 핵심 문제 분석

### 1. 친구 시스템 한계
- 게임 내 친구 제한: 최대 99명
- 갓팩: 희귀하므로 많은 사용자가 공유해도 문제없음
- 20% 팩: 너무 흔해서 모두가 친구추가하면 즉시 99명 초과

### 2. 현재 해결책의 한계
- 병렬 봇 실행으로 인한 리소스 낭비
- 코드 분산으로 유지보수 어려움
- 통합 관리 시스템 부재

## 기술적 분석

### 1. 데이터 흐름
```
사용자 → Heartbeat 메시지 → 봇 처리 → 데이터 저장
                              ↓
                        팩 감지 시 포럼 포스팅
                              ↓
                        커뮤니티 검증 (👍/👎)
                              ↓
                        Yet → Good/Bad 분류
```

### 2. 주요 기능별 복잡도
- **Heartbeat 처리**: 중간 (실시간 처리 필요)
- **친구 목록 생성**: 높음 (최적화 알고리즘 필요)
- **포럼 관리**: 중간 (Discord API 제약)
- **검증 시스템**: 낮음 (반응 카운트)

### 3. 성능 병목점
- GitHub Gist API 호출 제한
- Discord API Rate Limit
- 파일 I/O 빈도
- 동시 사용자 수 증가 시 처리 지연

## 20% 팩 관리 심화 분석

### 현재 문제
1. 무제한 친구 추가 → 99명 제한 초과
2. 효율적인 팩 공유 불가능
3. 사용자 불만 증가

### 제안된 해결책
1. **10명 그룹 시스템**
   - 장점: 친구 제한 내 관리 가능
   - 단점: 그룹 간 격리로 공유 효율 감소

2. **동적 그룹 관리**
   ```
   활발한 사용자 10명 → Group A
   중간 활동 10명 → Group B
   비활동 시 → 대기 그룹
   ```

3. **시간대별 순환**
   ```
   06:00-14:00 → Group 1 활성
   14:00-22:00 → Group 2 활성
   22:00-06:00 → Group 3 활성
   ```

## 통합 시 고려사항

### 1. 데이터 마이그레이션
- Gist → 로컬 파일 전환
- 사용자 데이터 무결성 보장
- 백업 및 복구 계획

### 2. 기능 우선순위
1. 핵심 기능 (Heartbeat, 팩 감지)
2. 사용자 경험 (명령어, 친구 목록)
3. 관리 기능 (통계, 모니터링)

### 3. 테스트 전략
- 단위 테스트: 각 모듈별
- 통합 테스트: 모듈 간 상호작용
- 부하 테스트: 동시 사용자 처리
- 사용자 수용 테스트: 실제 환경

## 권장 사항

### 단기 (1-2주)
1. Poke20.py 저장 경로 분리 (`data/raw20`)
2. 10명 제한 로직 구현
3. 테스트 서버 구축

### 중기 (1-2개월)
1. 모듈화 시작
2. 공통 기능 추출
3. 통합 봇 프로토타입

### 장기 (3-6개월)
1. 완전 통합 시스템
2. 웹 대시보드
3. 고급 분석 기능

## 결론
현재 시스템은 기능적으로는 작동하지만, 확장성과 유지보수성에 한계가 있음. 
점진적인 통합과 모듈화를 통해 더 효율적이고 관리하기 쉬운 시스템으로 발전 가능.