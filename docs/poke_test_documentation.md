# Poke.py 기능 명세 및 테스트 문서

## 1. 주요 컴포넌트

### 1.1 봇 초기화 및 설정
- **환경변수 로딩**: `.env` 또는 `.env.test` 파일에서 설정 로드
- **GIST 어댑터**: LocalFile을 사용하여 데이터 저장 (data/poke_data/)
- **서버 설정**: Group7, Group8 두 개 그룹 관리

### 1.2 데이터 구조
- **Member**: 모든 멤버 정보 (이름, 친구코드)
- **Admin**: 관리자 권한 목록
- **Group7/Group8**: 온라인 사용자 목록
- **GodPack7/GodPack8**: 갓팩 정보
- **GPTest7/GPTest8**: 갓팩 코드 테스트 정보

## 2. 이벤트 핸들러

### 2.1 on_ready
**트리거**: 봇이 Discord에 연결될 때
**기대 동작**:
- 연결 성공 메시지 출력
- 연결된 서버 수 표시
- 테스트 모드일 경우 모니터링 채널 정보 출력

### 2.2 on_message
**트리거**: HEARTBEAT 채널에 메시지가 도착할 때
**기대 동작**:
- 메시지 형식 검증 (온라인/대기중, 팩 선호도, 배럭, 유저, 코드)
- USER_DICT에서 사용자 찾기
- 온라인 상태 업데이트
- 서버별 FILE(Group7/Group8) 업데이트

**예시 메시지**:
```
[온라인 & 대기중]
나의 팩 선호도: 2P 
배럭: 피카츄ex★ [178]
유저: papawolf
코드: 7080-6165-9378
```

## 3. 백그라운드 태스크

### 3.1 update_periodic (300초마다)
**기능**: 오프라인 사용자 정리 및 온라인 목록 업데이트
**기대 동작**:
- 각 서버의 온라인 사용자 확인
- 10분 이상 업데이트 없는 사용자를 오프라인으로 변경
- 온라인 사용자 친구코드 목록 생성 및 저장

### 3.2 verify_periodic (900초마다)
**기능**: 갓팩 포스팅 검증 상태 업데이트
**기대 동작**:
- POSTING 채널의 포럼 스레드 확인
- 반응(👍/👎) 집계
- 갓팩 상태 업데이트 (Yet → Good/Bad)
- 3일 이상 지난 포스트 제거

## 4. 명령어 기능

### 4.1 !state
**권한**: 모든 사용자
**채널**: COMMAND 채널
**기대 동작**: 
- 온라인/등록 사용자 수 표시
- 온라인 사용자 목록 출력

### 4.2 !list
**권한**: 모든 사용자
**채널**: COMMAND 채널
**기대 동작**: 
- 온라인 사용자의 친구코드 목록 텍스트 제공
- 복사 가능한 형태로 출력

### 4.3 !gp <코드>
**권한**: 모든 사용자
**채널**: DETECT 채널
**기대 동작**:
- 갓팩 코드 검증
- 중복 확인
- 검증 안내 메시지와 함께 POSTING 채널에 포럼 스레드 생성
- 태그 자동 추가

### 4.4 !yet
**권한**: 모든 사용자
**채널**: COMMAND 채널
**기대 동작**:
- 미검증(Yet) 갓팩 목록 표시
- 최근 2-4일 Good 갓팩도 포함
- 사용자가 👎 반응한 포스트는 제외

### 4.5 !barracks
**권한**: 모든 사용자
**채널**: COMMAND 채널
**기대 동작**:
- 온라인 사용자별 배럭 수 표시
- 팩 타입별(3P/5P) 그룹화
- 총 배럭 수 및 분당 팩 개수 계산

### 4.6 !alive
**권한**: 모든 사용자
**채널**: 모든 채널
**기대 동작**:
- 각 서버의 마지막 점검 시간 표시

### 4.7 !add <이름> <코드>
**권한**: Admin만
**채널**: 모든 채널
**기대 동작**:
- Member에 새 사용자 추가
- USER_DICT 업데이트

### 4.8 !delete <이름> <코드>
**권한**: Admin만
**채널**: 모든 채널
**기대 동작**:
- Member에서 사용자 제거
- 모든 서버에서 오프라인 처리
- USER_DICT에서 제거

### 4.9 !mandate <디스코드ID>
**권한**: Admin만
**채널**: 모든 채널
**기대 동작**:
- Admin 목록에 새 관리자 추가

### 4.10 !admin
**권한**: 모든 사용자
**채널**: 모든 채널
**기대 동작**:
- 현재 권한자 목록 표시

### 4.11 !test_update (테스트 전용)
**권한**: Admin만
**채널**: 모든 채널
**기대 동작**:
- 온라인 상태 즉시 업데이트
- 10분 기다릴 필요 없이 즉시 실행

### 4.12 !test_verify (테스트 전용)
**권한**: Admin만
**채널**: COMMAND 채널
**기대 동작**:
- 갓팩 검증 즉시 실행
- 15분 기다릴 필요 없이 즉시 실행

### 4.13 !test_offline (테스트 전용)
**권한**: Admin만
**채널**: COMMAND 채널
**기대 동작**:
- 오프라인 처리 즉시 실행
- 타임아웃 대기 없이 즉시 처리

## 5. 테스트 시나리오

### 5.1 기본 연결 테스트
1. TEST_MODE=true로 봇 실행
2. 10초 내 자동 종료 확인
3. 연결 로그 확인

### 5.2 메시지 처리 테스트
1. HEARTBEAT 채널에 테스트 메시지 전송
2. 온라인 상태 업데이트 확인
3. Group7/Group8 파일 업데이트 확인

### 5.3 명령어 테스트
1. 각 명령어 실행
2. 예상 응답 확인
3. 데이터 파일 변경 확인

### 5.4 주기적 업데이트 테스트
1. 시간 경과 시뮬레이션
2. 오프라인 처리 확인
3. 갓팩 검증 상태 변경 확인

## 6. 에러 처리 확인 항목
- 잘못된 메시지 형식
- 존재하지 않는 사용자
- 권한 없는 명령어 실행
- 잘못된 채널에서의 명령어
- 네트워크 오류 시 복구

## 7. 성능 측정 항목
- 메시지 처리 시간
- 파일 I/O 속도
- 메모리 사용량
- API 호출 빈도