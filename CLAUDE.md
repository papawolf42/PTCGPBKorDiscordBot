# PTCGP 봇 프로젝트 컨텍스트

## 프로젝트 개요
포켓몬 트레이딩 카드 게임 갓팩(God Pack) 및 20% 팩 관리를 위한 Discord 봇 시스템

## 현재 아키텍처
- **병렬 실행 구조**: 여러 봇이 동시에 실행되며 각자의 기능 담당
  - Poke.py: GitHub Gist 기반 초기 버전 (Group7, Group8)
  - Poke2.py: 메인 갓팩 관리 봇 (파일 기반, 슬래시 명령어)
  - Poke20.py: 20% 팩 전용 봇 (Poke2.py 기반)
  - Poke3.py: 포럼 스레드 관리 특화 (Group1, Group3, Group6)
  - Poke4.py: 테스트용 봇

## 주요 문제점 및 개선 방향

### 1. 통합 필요성
- 현재 여러 파일을 병렬로 실행 중 (코드 복잡도로 인한 분리)
- 명령어가 특정 봇에만 존재하여 다른 봇은 "명령어 없음" 응답
- 유지보수 어려움 및 중복 코드 존재

### 2. 20% 팩 관리 이슈 (Poke20.py)
- **문제**: 20% 팩은 출현율이 높아 모든 사용자가 친구추가 시 99명 제한 초과
- **해결 방안**:
  - 한 그룹당 최대 10명으로 제한
  - 저장 경로 분리: `data/raw` → `data/raw20`
  - 그룹 분할 로직 필요 (선착순/활동량/팩 선호도 기준)

### 3. 테스트 환경 부재
- 라이브 환경에서 직접 테스트 → 버그 발생 시 사용자 불편
- 테스트 환경 구축 필요

## 데이터 구조
- **Heartbeat 데이터**: `data/heartbeat_data/` - 사용자 활동 추적
- **사용자 프로필**: `data/user_data/` - 설정 및 정보
- **친구 목록**: 
  - Poke2.py: `data/raw/`
  - Poke20.py: `data/raw/` (Old/New 구분) → `data/raw20/`로 변경 예정
- **GitHub Gist**: 온라인 사용자, 갓팩 정보

## 주요 기능
1. **사용자 모니터링**: Heartbeat로 온라인 상태, 배럭 수, 팩 선호도 추적
2. **갓팩/20% 팩 감지**: DETECT 채널에서 감지 후 자동 포럼 포스팅
3. **검증 시스템**: 커뮤니티 검증 (👍/👎 반응)
4. **친구 목록 자동 생성**: 온라인 사용자 친구 코드 수집 및 최적화
5. **목표 배럭 관리**: 사용자별 설정 및 오류 시 자동 조정

## 그룹별 채널 구조
각 그룹(Group1~Group8) 동일 구조:
- HEARTBEAT: 사용자 상태
- DETECT: 팩 감지
- POSTING: 포럼
- COMMAND: 봇 명령어
- MUSEUM: 검증된 갓팩

## 현재 논의 중인 사항
1. 봇 통합 방안 (모듈화 vs 단일 파일)
2. 20% 팩 사용자 그룹 관리 알고리즘
3. 테스트 환경 구축 방법
4. 코드 리팩토링 우선순위